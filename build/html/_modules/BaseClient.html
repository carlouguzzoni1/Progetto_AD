<!DOCTYPE html>

<html lang="en" data-content_root="../">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>BaseClient &#8212; sym-DFS-project 1.0 documentation</title>
    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=d1102ebc" />
    <link rel="stylesheet" type="text/css" href="../_static/basic.css?v=686e5160" />
    <link rel="stylesheet" type="text/css" href="../_static/alabaster.css?v=27fed22d" />
    <link rel="stylesheet" type="text/css" href="../_static/graphviz.css?v=4ae1632d" />
    <script src="../_static/documentation_options.js?v=f2a433a1"></script>
    <script src="../_static/doctools.js?v=9bcbadda"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  

  
  

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <h1>Source code for BaseClient</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">abc</span> <span class="kn">import</span> <span class="n">ABC</span><span class="p">,</span> <span class="n">abstractmethod</span>
<span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">rpyc</span>
<span class="kn">from</span> <span class="nn">tabulate</span> <span class="kn">import</span> <span class="n">tabulate</span>
<span class="kn">import</span> <span class="nn">utils</span>
<span class="kn">from</span> <span class="nn">getpass</span> <span class="kn">import</span> <span class="n">getpass</span>
<span class="kn">from</span> <span class="nn">apscheduler.schedulers.background</span> <span class="kn">import</span> <span class="n">BackgroundScheduler</span>
<span class="kn">import</span> <span class="nn">json</span>



<span class="c1"># Load configuration from file.</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s1">&#39;client_config.json&#39;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>

<span class="n">CLIENT_ROOT_DIR</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s1">&#39;root_dir&#39;</span><span class="p">]</span>



<div class="viewcode-block" id="BaseClient">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient">[docs]</a>
<span class="k">class</span> <span class="nc">BaseClient</span><span class="p">(</span><span class="n">ABC</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Abstract base class for client classes.&quot;&quot;&quot;</span>
    
    
    <span class="c1">##### DUNDER METHODS #####</span>
    
    
    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initializes the client.</span>
<span class="sd">        Args:</span>
<span class="sd">            host (str): The hostname or IP address of the name server.</span>
<span class="sd">            port (int): The port number of the name server.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># The root directory of the client.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">client_root_dir</span>    <span class="o">=</span> <span class="n">CLIENT_ROOT_DIR</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ns_host</span>            <span class="o">=</span> <span class="n">host</span>  <span class="c1"># Host for the name server.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">ns_port</span>            <span class="o">=</span> <span class="n">port</span>  <span class="c1"># Port for the name server.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span>               <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># Connection to the name server.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">user_is_logged</span>     <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Whether the user is logged in.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logged_username</span>    <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># The username of the logged in user.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files_dir</span>          <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># The directory of the logged in user.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span>              <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># The JWT token of the logged in user.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span>          <span class="o">=</span> <span class="kc">None</span>  <span class="c1"># The job scheduler.</span>
    
    
    <span class="k">def</span> <span class="fm">__del__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Closes the connection to the name server upon deletion.&quot;&quot;&quot;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shutting down client...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Close the connection.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Closing the connection to the name server...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
    
    
    <span class="c1">##### PRIVATE METHODS #####</span>
    
    
    <span class="k">def</span> <span class="nf">_cleanup</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Cleans up the client&#39;s state upon logout or keyboard interrupt.&quot;&quot;&quot;</span>
        
        <span class="c1"># Update the user status in the name server&#39;s database.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Logging out...&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">logout_user</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span>
        
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error logging out: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Reset the client&#39;s state.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Resetting the client&#39;s state...&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">user_is_logged</span>     <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">logged_username</span>    <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">files_dir</span>          <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">token</span>              <span class="o">=</span> <span class="kc">None</span>
        
        <span class="c1"># Stop the scheduler.</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Shutting down the job scheduler...&quot;</span><span class="p">)</span>
        
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">remove_all_jobs</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">scheduler</span>          <span class="o">=</span> <span class="kc">None</span>
    
    
<div class="viewcode-block" id="BaseClient.connect">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.connect">[docs]</a>
    <span class="k">def</span> <span class="nf">connect</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Establishes a connection to the name server.&quot;&quot;&quot;</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connecting to the name server...&quot;</span><span class="p">)</span>
        
        <span class="k">try</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">conn</span> <span class="o">=</span> <span class="n">rpyc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">ns_host</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">ns_port</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Connection established.&quot;</span><span class="p">)</span>
        
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error connecting to the server: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span></div>

    
    
    <span class="c1">##### ABSTRACT METHODS #####</span>
    
    
<div class="viewcode-block" id="BaseClient.display_commands">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.display_commands">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">display_commands</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays the available commands for the clients.&quot;&quot;&quot;</span>
        
        <span class="k">pass</span></div>

    
    
<div class="viewcode-block" id="BaseClient.main_prompt">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.main_prompt">[docs]</a>
    <span class="nd">@abstractmethod</span>
    <span class="k">def</span> <span class="nf">main_prompt</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;Displays the main prompt for the clients.&quot;&quot;&quot;</span>
        
        <span class="k">pass</span></div>

    
    
    <span class="c1">##### BASE CLIENT FUNCTIONALITIES #####</span>
    
    
    <span class="c1"># NOTE: le procedure di creazione/eliminazione di utenti sono le stesse per</span>
    <span class="c1">#       regular e root clients, in quanto si tratta di funzionalità di base.</span>
    
    
<div class="viewcode-block" id="BaseClient.create_user">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.create_user">[docs]</a>
    <span class="k">def</span> <span class="nf">create_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Creates a new regular user.</span>
<span class="sd">        </span>
<span class="sd">        Returns:</span>
<span class="sd">            bool: True if the user was created successfully, False otherwise.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">username</span>    <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Insert username: &quot;</span><span class="p">)</span>
        <span class="n">password</span>    <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Insert password: &quot;</span><span class="p">)</span>
        <span class="n">result</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">create_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span></div>

    
    
<div class="viewcode-block" id="BaseClient.delete_user">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.delete_user">[docs]</a>
    <span class="k">def</span> <span class="nf">delete_user</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes a regular user.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># NOTE: la cancellazione di un utente, per ora, avviene solo nel database del</span>
        <span class="c1">#       name server. Si suppone che l&#39;utente che ne cancella un altro sia di</span>
        <span class="c1">#       fatto la stessa persona, ma non si fanno supposizioni sull&#39;ubicazione</span>
        <span class="c1">#       di tale host. Per questo motivo, il client non si accolla l&#39;onere di</span>
        <span class="c1">#       cancellare la directory locale per tale utente, che pur non essendo</span>
        <span class="c1">#       più registrato, potrà ugualmente usufruire dei files che aveva in</span>
        <span class="c1">#       precedenza scaricato.</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_is_logged</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You must be logged in to delete a user.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">username</span>    <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Insert username: &quot;</span><span class="p">)</span>
            <span class="n">password</span>    <span class="o">=</span> <span class="n">getpass</span><span class="p">(</span><span class="s2">&quot;Insert password: &quot;</span><span class="p">)</span>
            <span class="n">result</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">delete_user</span><span class="p">(</span><span class="n">username</span><span class="p">,</span> <span class="n">password</span><span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

    
    
    <span class="c1"># NOTE: le procedure di visualizzazione/upload/download/cancellazione di files</span>
    <span class="c1">#       sono le stesse per regular e root clients, in quanto si tratta di</span>
    <span class="c1">#       funzionalità di base.</span>
    
    
<div class="viewcode-block" id="BaseClient.list_files">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.list_files">[docs]</a>
    <span class="k">def</span> <span class="nf">list_files</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Lists the user&#39;s files in the DFS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_is_logged</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You must be logged in to list files.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">get_user_files</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
            
            <span class="c1"># If the operation was successful, print the result.</span>
            <span class="k">if</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
                <span class="c1"># Convert the result to a list of dictionaries.</span>
                <span class="n">headers</span>         <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;File&quot;</span><span class="p">,</span> <span class="s2">&quot;Size&quot;</span><span class="p">,</span> <span class="s2">&quot;Is corrupted&quot;</span><span class="p">,</span> <span class="s2">&quot;Uploaded at&quot;</span><span class="p">,</span> <span class="s2">&quot;Primary Server&quot;</span><span class="p">]</span>
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="nb">dict</span><span class="p">(</span><span class="nb">zip</span><span class="p">(</span><span class="n">headers</span><span class="p">,</span> <span class="n">row</span><span class="p">))</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]]</span>
                                
                <span class="n">result</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span>
                    <span class="p">{</span>
                        <span class="s2">&quot;File&quot;</span>          <span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;File&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;Size&quot;</span>          <span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;Size&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;Is corrupted&quot;</span>  <span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;Is corrupted&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;Uploaded at&quot;</span>   <span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;Uploaded at&quot;</span><span class="p">],</span>
                        <span class="s2">&quot;Primary Server&quot;</span><span class="p">:</span> <span class="n">f</span><span class="p">[</span><span class="s2">&quot;Primary Server&quot;</span><span class="p">]</span>
                    <span class="p">}</span>
                    <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">]</span>
                <span class="p">]</span>
                
                <span class="nb">print</span><span class="p">(</span><span class="n">tabulate</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;files&quot;</span><span class="p">],</span> <span class="n">headers</span><span class="o">=</span><span class="s2">&quot;keys&quot;</span><span class="p">))</span></div>

    
    
<div class="viewcode-block" id="BaseClient.upload_file">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.upload_file">[docs]</a>
    <span class="k">def</span> <span class="nf">upload_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">client_path</span><span class="p">,</span> <span class="n">server_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Uploads a file into the DFS.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            client_path (str): The absolute path of the file to upload.</span>
<span class="sd">            server_path (str): The directory where the file will be stored.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Calculate the checksum of the file.</span>
        <span class="n">checksum</span>    <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">calculate_checksum</span><span class="p">(</span><span class="n">client_path</span><span class="p">)</span>
        
        <span class="c1"># Get the file&#39;s name and size.</span>
        <span class="n">file_name</span>   <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">client_path</span><span class="p">)</span>
        <span class="n">file_size</span>   <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">getsize</span><span class="p">(</span><span class="n">client_path</span><span class="p">)</span>
        
        <span class="c1"># Concatenate the file path with the file name to get the absolute path</span>
        <span class="c1"># server-side.</span>
        <span class="n">server_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">server_path</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        
        <span class="c1"># Ask the name server for the file server.</span>
        <span class="n">result</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">get_file_server_upload</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">,</span>
            <span class="n">server_path</span><span class="p">,</span>
            <span class="n">file_size</span><span class="p">,</span>
            <span class="n">checksum</span>
            <span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
        
        <span class="c1"># If a file server was not found or an error occured, exit.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
            <span class="k">return</span>
        
        <span class="c1"># Get the file server&#39;s host and port.</span>
        <span class="n">fs_host</span>     <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span>
        <span class="n">fs_port</span>     <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span>
        
        <span class="c1"># Connect to the file server.</span>
        <span class="n">fs_conn</span>     <span class="o">=</span> <span class="n">rpyc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">fs_host</span><span class="p">,</span> <span class="n">fs_port</span><span class="p">)</span>
        
        <span class="c1"># Upload the file.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">client_path</span><span class="p">,</span> <span class="s2">&quot;rb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">file_data</span>       <span class="o">=</span> <span class="n">file</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
            <span class="n">upload_result</span>   <span class="o">=</span> <span class="n">fs_conn</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">store_file</span><span class="p">(</span>
                <span class="n">server_path</span><span class="p">,</span>
                <span class="n">file_data</span><span class="p">,</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">token</span>
                <span class="p">)</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">upload_result</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
        
        <span class="c1"># Close the file server connection.</span>
        <span class="n">fs_conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    
    
<div class="viewcode-block" id="BaseClient.upload">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.upload">[docs]</a>
    <span class="k">def</span> <span class="nf">upload</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User interface for uploading a file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_is_logged</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You must be logged in to upload a file.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">file_name</span>   <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Insert absolute file path: &quot;</span><span class="p">)</span>
            <span class="n">server_path</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Insert the directory where the file will be stored: &quot;</span><span class="p">)</span>
            
            <span class="c1"># Check if the file exists.</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">file_name</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;File </span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> not found.&quot;</span><span class="p">)</span>
                
                <span class="k">return</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">upload_file</span><span class="p">(</span><span class="n">file_name</span><span class="p">,</span> <span class="n">server_path</span><span class="p">)</span></div>

    
    
<div class="viewcode-block" id="BaseClient.download_file">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.download_file">[docs]</a>
    <span class="k">def</span> <span class="nf">download_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Downloads a file from the DFS.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            server_path (str): The absolute path of the file to download on the DFS.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="c1"># Ask the name server for a file server to download the file.</span>
        <span class="n">result</span>      <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">get_file_server_download</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">,</span> <span class="n">server_path</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
        
        <span class="c1"># If a file server was not found or an error occured, exit.</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;status&quot;</span><span class="p">]:</span>
            <span class="k">return</span>
        
        <span class="c1"># Get the file server&#39;s host and port.</span>
        <span class="n">fs_host</span>     <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;host&quot;</span><span class="p">]</span>
        <span class="n">fs_port</span>     <span class="o">=</span> <span class="n">result</span><span class="p">[</span><span class="s2">&quot;port&quot;</span><span class="p">]</span>
        
        <span class="c1"># Connect to the file server.</span>
        <span class="n">fs_conn</span>     <span class="o">=</span> <span class="n">rpyc</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="n">fs_host</span><span class="p">,</span> <span class="n">fs_port</span><span class="p">)</span>
        
        <span class="c1"># Get the file name.</span>
        <span class="n">file_name</span>   <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">server_path</span><span class="p">)</span>
        
        <span class="c1"># Create all the directories to store the file.</span>
        <span class="nb">dir</span>         <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">files_dir</span>
        
        <span class="k">for</span> <span class="n">directory</span> <span class="ow">in</span> <span class="n">server_path</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)[</span><span class="mi">1</span><span class="p">:</span><span class="o">-</span><span class="mi">1</span><span class="p">]:</span>
            <span class="nb">dir</span>     <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">directory</span><span class="p">)</span>
            
            <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="nb">dir</span><span class="p">):</span>
                <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="nb">dir</span><span class="p">)</span>
        
        <span class="c1"># Concatenate the file path with the file name to get the absolute path</span>
        <span class="c1"># client-side.</span>
        <span class="n">client_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">dir</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
        
        <span class="c1"># Download the file.</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">client_path</span><span class="p">,</span> <span class="s2">&quot;wb&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">fs_conn</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">send_file</span><span class="p">(</span><span class="n">server_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
            
            <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;message&quot;</span><span class="p">])</span>
            <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">result</span><span class="p">[</span><span class="s2">&quot;file_data&quot;</span><span class="p">])</span>
        
        <span class="c1"># Close the file server connection.</span>
        <span class="n">fs_conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span></div>

    
    
<div class="viewcode-block" id="BaseClient.download">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.download">[docs]</a>
    <span class="k">def</span> <span class="nf">download</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User interface for downloading a file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_is_logged</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You must be logged in to download a file.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">server_abs_path</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Insert the absolute path of the file to download: &quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">download_file</span><span class="p">(</span><span class="n">server_abs_path</span><span class="p">)</span></div>

    
    
<div class="viewcode-block" id="BaseClient.delete_file">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.delete_file">[docs]</a>
    <span class="k">def</span> <span class="nf">delete_file</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">server_path</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Deletes a file from the DFS.</span>
<span class="sd">        </span>
<span class="sd">        Args:</span>
<span class="sd">            server_path (str): The absolute path of the file to delete.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="n">result</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">conn</span><span class="o">.</span><span class="n">root</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">server_path</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">token</span><span class="p">)</span>
        
        <span class="nb">print</span><span class="p">(</span><span class="n">result</span><span class="p">)</span></div>

    
    
<div class="viewcode-block" id="BaseClient.delete">
<a class="viewcode-back" href="../BaseClient.html#BaseClient.BaseClient.delete">[docs]</a>
    <span class="k">def</span> <span class="nf">delete</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        User interface for deleting a file.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">user_is_logged</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;You must be logged in to delete a file.&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">server_abs_path</span> <span class="o">=</span> <span class="nb">input</span><span class="p">(</span><span class="s2">&quot;Insert the absolute path of the file to delete: &quot;</span><span class="p">)</span>
            
            <span class="bp">self</span><span class="o">.</span><span class="n">delete_file</span><span class="p">(</span><span class="n">server_abs_path</span><span class="p">)</span></div>
</div>

</pre></div>

          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="Main">
        <div class="sphinxsidebarwrapper">
<h1 class="logo"><a href="../index.html">sym-DFS-project</a></h1>









<search id="searchbox" style="display: none" role="search">
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false" placeholder="Search"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</search>
<script>document.getElementById('searchbox').style.display = "block"</script><h3>Navigation</h3>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  <li><a href="index.html">Module code</a><ul>
  </ul></li>
  </ul></li>
</ul>
</div>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &#169;2025, Carlo Uguzzoni.
      
      |
      Powered by <a href="https://www.sphinx-doc.org/">Sphinx 8.1.3</a>
      &amp; <a href="https://alabaster.readthedocs.io">Alabaster 1.0.0</a>
      
    </div>

    

    
  </body>
</html>